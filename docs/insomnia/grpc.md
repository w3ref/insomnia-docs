---
layout: article-detail
title:  gRPC
category: "Встроенные функции"
category-url: built-in-features
---

С появлением Интернета вещей, микросервисов и ячеистых сетей API-интерфейсы должны быть более производительными и масштабируемыми, чем когда-либо прежде. Это привело к растущему внедрению [gRPC](https://grpc.io/), высокопроизводительной универсальной среды RPC с открытым исходным кодом, разработанной в Google.

Insomnia поддерживает выполнение запросов gRPC вместе с REST и GraphQL.

## Создать запрос

Чтобы создать новый запрос gRPC, нажмите + на боковой панели, а затем **Новый запрос**.

Затем в открывшемся модальном окне задайте имя для вашего запроса и выберите **gRPC** из раскрывающегося списка методов. Нажмите **Создать**.

Вам будет предложено выбрать файл proto. Нажмите **Добавить прото-файл** и выберите прото-файл из вашей файловой системы. Вы можете получить пример прото-файла из [grpcb.in](https://grpcb.in/). После добавления он должен быть выбран автоматически. Нажмите «Сохранить».

Теперь вы должны увидеть запрос на боковой панели, а при нажатии **Выбрать метод** вы должны увидеть службы из вашего прото-файла в списке.

## Протофайловое управление

В текущей итерации Insomnia позволяет вам загружать ваш прото-файл или набор прото-файлов (каталог) в рабочую область и использовать его с несколькими запросами. Insomnia проглотит содержимое ваших прото-файлов и не будет связано с исходным файлом в вашей файловой системе. Это означает, что если вы добавите свой прото-файл в Insomnia, а затем измените исходный файл, вам нужно будет загрузить его повторно.

Таким образом, прото-файл также не может импортировать другой прото-файл из вашей файловой системы, поскольку ссылка на относительный путь будет потеряна. Вы можете загрузить каталог, содержащий несколько прото-файлов, и они могут импортировать другие прото-файлы в эту структуру каталогов (см. ниже). В будущих итерациях мы намерены расширить способы ввода прото-файла, включая синхронизацию с файловой системой, загрузку из сетевого расположения.

### Добавить прото файл

Мы добавили прото-файл при создании запроса выше. Всякий раз, когда вам нужно выбрать прото-файл, вам будет предоставлена возможность добавить новый. В приведенном выше примере мы добавили прото-файл при создании нового запроса, но допустим, теперь мы хотим изменить прото-файл, связанный с текущим запросом, добавив новый. Перейдите к запросу и выберите **щелкните, чтобы изменить прото-файл**.

Это снова откроет модальные файлы proto и отобразит тот, который мы добавили ранее. Нажмите **Добавить протофайл** и добавьте новый. Теперь мы видим два прото-файла, добавленных в рабочую область.

### Добавить каталог

Нажмите **Добавить каталог**, чтобы добавить сразу несколько.

«root.proto» импортирует все остальные прото-файлы, перечисленные в каталоге **Library**.

### Переименовать прото-файл

Дважды щелкните имя прото-файла, чтобы отредактировать его. Файлы внутри каталога не могут быть переименованы.

### Повторно загрузить

Нажмите кнопку загрузки и выберите прото-файл из вашей файловой системы. Это может быть любой файл, это не обязательно должен быть один и тот же файл. Просто помните, что когда вы повторно загружаете прото-файл, все запросы, которые ссылаются на файл, который вы изменили, также будут обновлены. В идеале вы будете повторно загружать один и тот же прото-файл только тогда, когда определение сервиса изменилось, а не вообще новый файл.

### Удалить

Нажмите на кнопку удаления. Вам будет предложено сообщение с подтверждением, указывающее, что запросы, использующие этот прото-файл, могут быть нарушены, потому что информация об исходном прото-файле была потеряна. В будущем мы намерены расширить возможности удаления прото-файлов, чтобы обеспечить больший контроль над зависимыми запросами.

## Делать запросы

Insomnia поддерживает все четыре типа RPC, определенные gRPC. Это: [Unary](https://grpc.io/docs/what-is-grpc/core-concepts/#unary-rpc), [Client Streaming](https://grpc.io/docs/what-is-grpc/core-concepts/#client-streaming-rpc), [Server Streaming](https://grpc.io/docs/what-is-grpc/core-concepts/#server-streaming-rpc) и [Bidirectional Streaming](https://grpc.io/docs/what-is-grpc/core-concepts/#bidirectional-streaming-rpc). В следующих примерах используется [hello.proto](https://github.com/moul/pb/blob/master/hello/hello.proto) из grpcb.in.

### Унарный

`/hello.HelloService/SayHello` — это унарный RPC. Вы отправляете одно сообщение, и сервер отвечает одним сообщением.

Укажите текст и нажмите **Отправить**.

### Потоковая передача сервера

`/hello.HelloService/LotsOfReplies` — сервер, выполняющий потоковую передачу RPC. Вы отправляете одно сообщение, а сервер отвечает несколькими сообщениями.

Укажите текст и нажмите **Отправить**.

{:.alert .alert-primary}
**Note**: Скорость ответа зависит от сервера. В приведенном ниже примере второй запрос использует grpcbin.proto, где серверный поток отвечает намного медленнее и его легче визуализировать.

### Клиентская потоковая передача

`/hello.HelloService/LotsOfGreetings` — клиентский потоковый RPC. Вы отправляете несколько сообщений, а сервер отвечает одним сообщением.

Нажмите «Пуск», чтобы открыть канал с сервером. Теперь отредактируйте тело с содержимым вашего первого сообщения и нажмите кнопку **Stream**, чтобы отправить это сообщение. Вы должны увидеть снимок сообщения, доступный только для чтения, в виде вкладки. Теперь вы можете снова редактировать содержимое на вкладке «Тело» и нажимать «Поток» каждый раз, когда хотите отправить новое сообщение. Как только все сообщения будут отправлены, нажмите **Commit**, и сервер должен отреагировать соответствующим образом.

### Двунаправленная потоковая передача

`/hello.HelloService/BiDiHello` — это двунаправленный потоковый RPC. Вы отправляете несколько сообщений, и сервер отвечает несколькими сообщениями.

Как следует из названия, это комбинация серверной и клиентской потоковой передачи. Таким образом, шаги по отправке сообщений идентичны клиентской потоковой передаче выше, а способ, которым сервер выбирает ответ, идентичен серверной потоковой передаче. Не забудьте нажать «commit», как только вы закончите отправлять все свои сообщения, и позвольте серверу разорвать соединение.

## Отменить запрос

Каждый раз, когда был отправлен запрос (унарная, серверная потоковая передача) или открыт поток (клиентская и двунаправленная потоковая передача), кнопка «Отправить» или «Пуск» изменится на «Отмена». Нажатие этой кнопки прервет соединение и покажет соответствующее сообщение. Вы можете одновременно выполнять несколько запросов и отменять их по отдельности.

## TLS/SSL

Часто конечная точка gRPC будет защищена TLS, и Insomnia позволит вам подключаться к этим конечным точкам с помощью простого SSL. Возможность предоставления пользовательских сертификатов появится в будущем.

Чтобы включить TLS, добавьте к хосту префикс `grpcs://`.

Например, grpcb.in имеет незащищенную конечную точку по адресу `grpcb.in:9000` и защищенную конечную точку по адресу `grpcb.in:9001`.

Выполнение запроса к `grpcb.in:9001` не удастся.

Выполнение запроса к `grpcs://grpcb.in:9001` завершится успешно.

## Переменные среды и теги шаблона

В выпуске 2021.1 Insomnia представлена поддержка переменных среды и тегов шаблонов в gRPC. Переменные среды и шаблоны Nunjucks можно использовать как в адресной строке, так и в теле сообщения.

## Известные ограничения

Начиная с версии 2021.1 gRPC в Insomnia не включает:

* Поддержка выполнения запросов gRPC в модульных тестах.
* Поддержка или запрос цепочки
* Поддержка метаданных или крайних сроков gRPC
* Постоянство запросов/ответов и истории
* Перемещение запросов gRPC между рабочими областями
    * Если папка, содержащая запрос gRPC, перемещена в другую рабочую область, запрос будет перемещен, а прото-файл — нет.
