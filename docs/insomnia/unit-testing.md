---
layout: article-detail
title:  Модульное и стресс-тестирование
category: Тестирование
category-url: testing
---

Insomnia не имеет встроенной возможности стресс-тестирования, однако для этого есть множество инструментов. Пожалуйста, обратитесь к этим следующим ссылкам для получения дополнительной информации и использования:

* [k6](https://k6.io/docs/testing-guides/api-load-testing/)
* [locust](https://locust.io/)
* [loader](https://loader.io/)

В оставшейся части этого документа рассказывается, как использовать функциональность модульного тестирования в Insomnia. В настоящее время модульное тестирование доступно только для проектных документов, хотя для их написания строго не требуется спецификация OpenAPI.

## Как создать набор модульных тестов

1. Импортируйте и выберите документ OpenAPI в качестве документа дизайна.
2. Перейдите на вкладку **Debug**, чтобы убедиться, что запросы созданы и работают.
3. Перейдите на вкладку **Test** и нажмите **New Test Suite**.
4. Назвав свой набор тестов, нажмите **Create Suite**.

## Как удалить набор модульных тестов

1. Нажмите стрелку раскрывающегося списка на наборе тестов, который вы хотите удалить, на боковой панели.
2. Щелкните **Delete Suite**.

## Как создать модульный тест

Модульные тесты в Insomnia основаны на [фреймворке Chai](https://www.chaijs.com/api/bdd/).

1. Выберите набор модульных тестов, в котором вы хотите создать модульный тест, и нажмите кнопку “New Test”.
2. Вам будет представлено модальное диалоговое окно с просьбой дать имя модульному тесту.
3. После того, как вы назвали свой модульный тест, нажмите «Создать тест», теперь вам будет представлен интерфейс модульного теста, который содержит имя модульного теста, раскрывающийся список отладочного запроса, кнопку удаления, кнопку запуска и кнопку редактора кода модульного теста, где вы можете написать свой модульный тест на JavaScript.
4. Щелкните стрелку, чтобы открыть редактор кода, чтобы можно было редактировать тест.
5. Выберите запрос, который вы хотите использовать для своего модульного теста, из раскрывающегося списка **Select Request** (мы предлагаем использовать простой запрос GET для вашего первого модульного теста).
6. Запустите тест, чтобы убедиться, что он работает правильно.

### Как проверить тела ответа?

Вы можете проверить полезную нагрузку ответа, обратившись к атрибуту `.data` переменной ответа:

```ts
const response = await insomnia.send();
expect(response.data).to.be.an('string');
```

### Как проверить полезные данные JSON?

По умолчанию `response.data` будет строкой. Если вы хотите проверить его как JSON, вы должны сначала преобразовать `response.data` в JSON с помощью `JSON.parse`:

```ts
const response = await insomnia.send();
const body = JSON.parse(response.data);

expect(body).to.be.an('array');
```

### Как проверить свойства полезной нагрузки JSON?

Поскольку модульные тесты полагаются на библиотеку Chai для модульного тестирования, мы можем легко тестировать свойства после преобразования нашей полезной нагрузки ответа в JSON:

```ts
const response = await insomnia.send();
const body = JSON.parse(response.data);
const item = body[0];

expect(body).to.be.an('array');
expect(item).to.be.an('object');
expect(item).to.have.property('id');
```

### Как протестировать несколько запросов в одном модульном тесте?

1. Вы можете добавить дополнительные запросы или настроить таргетинг на конкретный запрос, нажав CTRL + Пробел, когда выделена область кода модульного теста. В раскрывающемся меню вы можете выбрать запуск текущего выбранного запроса или запроса по определенному идентификатору.
2. При выборе отправки запроса по идентификатору вам будет предложено модальное окно с вопросом, какой запрос отправить.
3. Редактор кода будет предварительно заполнен шаблоном запроса/ответа для выбранного запроса.

### Как связать запросы?

Сцепление запросов так же просто, как следование руководству по созданию цепочки запросов, а затем выбор связанного запроса из раскрывающегося списка **Select Request**.

### Как изменить значения запроса?

Поскольку модульные тесты полагаются на запросы и выбранную среду на вкладке отладки, единственный способ изменить запрос, выполняемый в модульном тесте, - это изменить запрос и его переменные среды на вкладке отладки.

### Как я могу отладить свой модульный тест?

1. Откройте [DevTools](/insomnia/introduction-to-plugins#debug-in-the-insomnia-app).
2. Откройте вкладку **console**. По умолчанию он должен быть открыт.

Теперь, когда мы открыли DevTools и открыли консоль, мы можем выводить значения `console.log` в нашем модульном тесте на консоль:

```ts
const response = await insomnia.send();
const body = JSON.parse(response.data);
const item = body[0];

console.log(item);
```

### Как запустить модульные тесты в CI?

Запускайте модульные тесты в CI (например, GitHub Actions или Azure DevOps) с помощью [git sync](/insomnia/git-sync) и [Inso CLI](/inso-cli/cli-command-reference/inso-run-test) с командой `inso run test`.

### Как переименовать модульный тест?

Переименуйте модульный тест, дважды щелкнув имя модульного теста и изменив его содержимое.

Значение сохраняется, когда вы щелкаете за пределами редактируемой области.

### Как удалить модульный тест?

Удалите модульный тест, щелкнув иконку **Delete** рядом с тестом.
